@model Phonebook.Models.Contact

<h2>Create Contact</h2>

<form asp-action="Create" method="post" enctype="multipart/form-data">
    @Html.AntiForgeryToken()

    <div class="form-group">
        <label asp-for="Name" class="form-label"></label>
        <input asp-for="Name" class="form-control" placeholder="Name" />
    </div>
    <br />

    <div class="form-group">
        <label asp-for="Phone" class="form-label"></label>
        <input asp-for="Phone" class="form-control" placeholder="Phone" />
    </div>
    <br />

    <div class="form-group">
        <label asp-for="Email" class="form-label"></label>
        <input asp-for="Email" class="form-control" placeholder="Email" />
    </div>
    <br />

    <div class="form-group">
        <label asp-for="Birthday" class="form-label"></label>
        <input asp-for="Birthday" class="form-control" type="date" />
    </div>
    <br />

    <div class="form-group">
        <label class="form-label">Picture (optional)</label>

        <!-- preview -->
        <div style="margin-bottom:10px;">
            <img id="preview" src="~/images/default_contact.png"
                 style="width:150px; height:150px; object-fit:cover; border-radius:8px; border:1px solid #ccc;"
                 alt="Preview" />
        </div>

        <!-- file input (kept as original but improved) -->
        <input type="file" id="fileInput" name="file" class="form-control" accept="image/*" />
        <small class="form-text text-muted">Allowed: image files. Recommended: square JPG/PNG, max ~2MB.</small>

        <div style="margin-top:8px;">
            <button type="button" id="clearFile" class="btn btn-outline-secondary btn-sm">Remove selection</button>
        </div>
    </div>
    <br />

    <button type="submit" class="btn btn-success">Save</button>
    <a asp-action="Index" class="btn btn-secondary">Back</a>
</form>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        (function () {
            const fileInput = document.getElementById('fileInput');
            const preview = document.getElementById('preview');
            const clearBtn = document.getElementById('clearFile');

            fileInput.addEventListener('change', function (e) {
                const file = this.files && this.files[0];
                if (!file) {
                    preview.src = '@Url.Content("~/images/default_contact.png")';
                    return;
                }

                if (!file.type.startsWith('image/')) {
                    alert('Please select an image file.');
                    fileInput.value = '';
                    preview.src = '@Url.Content("~/images/default_contact.png")';
                    return;
                }

                const reader = new FileReader();
                reader.onload = function (ev) {
                    preview.src = ev.target.result;
                };
                reader.readAsDataURL(file);
            });

            clearBtn.addEventListener('click', function () {
                fileInput.value = '';
                preview.src = '@Url.Content("~/images/default_contact.png")';
            });
        })();
    </script>
}
